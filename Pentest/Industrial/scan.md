# Scanning industrial environments

The scanning rulles are a little bit different in industrial environments. Take the following example:

```
Wednesday, 9:45 AM
Bob sat down at the display terminal with his second morning cup of coffee and continued to scan over the Human-Machine Interface (HMI). On the desk in front of him were three 23-inch monitors, connected and placed side by side. He scoffed, annoyed at the login prompt.
“IT security...,” he thought sarcastically.
He remembered when things were much simpler—and much more convenient. He used to be able to walk away from his terminal, go out for a smoke, get a fresh cup of coffee, and when he returned, there were his displays waiting for him, just the way he left them. Now he had to come back to an annoying password screen.
“Seriously,” he thought. “Who’s going to jack with my terminal while I hit the head?”
He typed in his username, operator1, followed by his password, operator1234. The terminal displays were all mostly in gray tones, providing varying data readouts, and one full-color representation of tanks, gauges, pumps, and valves. It was business as usual for the control room operator.
Then, something odd caught his eye. As a seasoned operator, Bob was used to seeing a variety of alarms; there wasn’t much he hadn’t come across. But this was different.
“What the...,” he leaned forward, squinting as he concentrated. A few mouse clicks later and a couple more sips of his piping hot coffee, and he picked up the phone. “Morning, Jim. How goes it?”
“Another day, another dollar, brother... until Uncle Sam takes his share. What’s up?”
“I hear ya. Hey, I’m getting weird readings on some controllers here. It doesn’t make sense, and it looks like several all at once. Can you check it out?”
“Yeah, sure; no problem, bud. What are those numbers?”
Jim wrote down the device ID numbers on a notepad as Bob gave them to him. “I’ll check it out and get right back to you.”
“Thanks, Jim,” Bob said and then hung up and resumed enjoying his coffee.
Jim minimized the email window on his workstation and opened up the Windows Remote Desktop tool. Corporate workstations aren’t typically allowed to access the Process Control Network (PCN), but Jim had installed a second Network Interface Card (NIC) on his. He now had one network connection to the corporate network and one to the PCN so he could have easy access to both corporate services as well as his process network assets. Dual-homed connections such as these were against the new cybersecurity policy, but this was how he and his fellow engineers had been accessing digital equipment ever since the conversion to the Ethernet standard. Even though it presented a potential security risk, operators still did this quite often in order to get email alerts from the HMI, and engineers did it for easier access to process assets and equipment. For them, these new security policies just made it harder to do their jobs.
Jim figured, What IT doesn’t know won’t hurt anybody.
The Remote Desktop display to a PCN engineering workstation popped up, and he began going through his diagnostic checks. What he discovered was, indeed, troubling. Several of his Programmable Logic Controllers (PLCs) were going into fault mode and resetting. This wasn’t causing any critical circumstances because when they reset, they would fail over to the backup PLC on the “B network.” But the backup PLC was misbehaving in the same manner and would fail back over to the first PLC on the primary “A network.” The pattern kept repeating, cycling through resetting and failing back over to the other network. And it was happening on not just one pair of PLCs, but several. If this continued, the operators could lose control of certain equipment.
Jim had learned a trick from his buddy in IT and figured he would give it a shot. He fired up a tool called Wireshark, a network “sniffer” used for network traffic analysis. He began seeing network packets scroll across the screen, and he immediately knew things were not right. The traffic on his process network was usually relatively light and predictable. However, he was seeing a flood of ICMP protocol requests as well as some TCP protocol traffic originating from an adjacent corporate network. Jim wasn’t used to seeing this type of network traffic on his process network, and it certainly shouldn’t be coming from a corporate network!
Jim picked up the phone to call his buddy Mike in IT. “Hey, Mike, this is Jim. What’s goin’ on man?”
“Jimbo! Not much bro, just having to deal with this security assessment.”
Jim could feel his face begin to flush and his temper flare. “Security assessment? What kind of security assessment? Are ya’ll doing something that might be knocking over my equipment? I’ve got PLCs going down left and right over here.”
“Uh... shouldn’t be,” said Mike, sounding a bit confused. “The PCN isn’t in scope for this assessment. It’s just the corporate IT networks.”
“Well, I’m seeing all sorts of network traffic coming from the corporate network and hitting my equipment. Don’t we have some kind of firewall or something that’s supposed to keep this from happening?” Jim asked anxiously.
“We have a firewall in place between corporate and the PCN, but we let ICMP through. What can a few pings hurt? We also leave a couple of TCP ports open to communicate with others like the historian. Besides, all they’re doing right now is some light Nmap scanning. Mainly just ping sweeps and SYN requests,” Mike was defensive, but getting nervous.
“What the heck is an Nmap?” Jim exclaimed, increasingly more annoyed. “You can’t treat my equipment like it’s your IT network! Regardless of what is supposed to be in scope or not, your assessment is knocking over my equipment! I need it to stop immediately!”
“Oh man. OK, I’ll get on the horn and have them pause what they are doing. Let me know if you see any changes.
“Alright, thanks, bud,” Jim said as he hung up the phone and leaned back in his chair, shaking his head.
A few minutes later, Jim noticed that the suspicious traffic from the corporate network had ceased, and his process network seemed to be back to normal.
“IT security...” he thought sarcastically.
``` [****]
The example spoke for itself!

Generally, it's risky to use active scanning tools in industrial environments due to high ammount of noise they produce; even this can lead to a catastrophe!

There are some ICS-safe methods which can be used to map the network inside an industrial environment:

## 1. arping

#### A. Check wether an device is online or not

```
$ arping --interface=eth0 -c 10.0.0.100
```

#### B. Check a range

```
$ sudo arp-scan --interface=wlan0 192.168.1.1/24
```

and even better, add a 2000 miliseconds delay between hosts:

```
$ sudo arp-scan --interface=wlan0  -i 2000 192.168.1.1/24
```

use CTRL+V to see live discovered hosts!

## 2. p0f

A way better when it comes about fingerprinting:

```
$ sudo p0f -i wlan0
```

## Commercial tools

  * **Sophia** by *NexDefense* -> https://www.nexdefense.com/
  * **Cyberlens** -> https://cyberlens.io/
  * **Indegy** -> https://www.indegy.com/
  * **XSense** by *CyberX* -> https://cyberx-labs.com/en/xsense-5/
  * **CylancePROTECT** by *Cylance* -> https://www.cylance.com/en_us/products/our-products/protect.html

## Resources and bibliography:

Quoted from: **** **HACKING EXPOSED: ICS and SCADA Security Secrets and Solutions** by *C. E. Bodungen, B. L. Singer, A. Shbeeb, S. Hilt, K. Wilhoit*